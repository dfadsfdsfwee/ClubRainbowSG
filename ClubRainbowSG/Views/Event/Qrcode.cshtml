<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.0.0/minified/html5-qrcode.min.js"></script>
    <style>
        #qr-code-scanner {
            width: 100%;
            height: 400px;
            border: 1px solid black;
        }

        #file-input {
            margin-top: 10px;
        }

        #status {
            margin-top: 10px;
            color: green;
            font-weight: bold;
        }

        #access-button {
            margin-top: 10px;
            display: none; /* Hidden by default */
        }
    </style>
</head>
<body>

    <h1>QR Code Scanner</h1>

    <button id="start-scanning-button">Start Scanning</button>
    <button id="stop-scanning-button" disabled>Stop Scanning</button>
    <input type="file" id="file-input" accept="image/*">
    <div id="qr-code-scanner"></div>

    <div id="result">
        <p>QR Code result: <span id="qr-result"></span></p>
    </div>

    <!-- Button to access the website -->
    <button id="access-button">Go to Website</button>

    <p id="status"></p>

    <script>
        let scanner;

        const startScanningButton = document.getElementById("start-scanning-button");
        const stopScanningButton = document.getElementById("stop-scanning-button");
        const fileInput = document.getElementById("file-input");
        const qrScannerContainer = document.getElementById("qr-code-scanner");
        const qrResult = document.getElementById("qr-result");
        const status = document.getElementById("status");
        const accessButton = document.getElementById("access-button");

        function updateStatus(message, color = "green") {
            status.textContent = message;
            status.style.color = color;
        }

        startScanningButton.addEventListener("click", function () {
            updateStatus("Starting scanner...");
            if (scanner) {
                scanner.stop().then(() => {
                    scanner = null;
                    initializeScanner();
                }).catch(err => {
                    updateStatus("Error stopping scanner: " + err, "red");
                });
            } else {
                initializeScanner();
            }
        });

        function initializeScanner() {
            scanner = new Html5Qrcode("qr-code-scanner");
            scanner.start(
                { facingMode: "environment" },
                {
                    fps: 10,
                    qrbox: 250,
                },
                (decodedText) => {
                    updateStatus("QR Code decoded: " + decodedText);
                    qrResult.textContent = decodedText;
                    stopScanning();
                },
                (errorMessage) => {
                    console.log("Scanning error: " + errorMessage);
                }
            ).then(() => {
                stopScanningButton.disabled = false;
                updateStatus("Scanner is running...");
            }).catch(err => {
                updateStatus("Error starting scanner: " + err, "red");
            });
        }

        stopScanningButton.addEventListener("click", function () {
            stopScanning();
        });

        function stopScanning() {
            if (scanner) {
                scanner.stop().then(() => {
                    stopScanningButton.disabled = true;
                    updateStatus("Scanner stopped.");
                    clearScannerView();
                }).catch(err => {
                    updateStatus("Error stopping scanner: " + err, "red");
                });
            }
        }

        function clearScannerView() {
            qrScannerContainer.innerHTML = "";
        }

        fileInput.addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) {
                updateStatus("No file selected", "red");
                return;
            }

            if (!scanner) {
                scanner = new Html5Qrcode("qr-code-scanner");
            }

            scanner.scanFile(file, true)
                .then(decodedText => {
                    qrResult.textContent = decodedText;
                    updateStatus("Decoded from file: " + decodedText);

                    // Show the access button and set its link
                    accessButton.style.display = "block";
                    accessButton.onclick = function () {
                        window.location.href = decodedText; // Redirect to the decoded URL
                    };
                })
                .catch(err => {
                    updateStatus("Error scanning file: " + err, "red");
                });
        });
    </script>

</body>
</html>
